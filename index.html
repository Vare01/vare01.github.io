<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shocking Math | Human Metrics Hub</title>
    <style>
        :root {
            --primary: #00ff88;
            --bg: #0b0f1a;
            --card: #161b2a;
            --text: #f8fafc;
            --sidebar-w: 280px;
            --accent: #3b82f6;
            --border: #2d334a;
            --input-bg: #0b0f1a;
        }

        body.light-theme {
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #0f172a;
            --border: #e2e8f0;
            --input-bg: #f8fafc;
            --accent: #2563eb;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            transition: background 0.3s, color 0.3s;
        }

        .sidebar {
            width: var(--sidebar-w);
            background: var(--card);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column;
            padding: 25px; flex-shrink: 0; z-index: 100;
        }

        .logo-container { margin-bottom: 25px; position: relative; }
        .logo {
            font-size: 1.4rem; font-weight: 900; color: var(--primary);
            letter-spacing: -1px; display: flex; align-items: center; gap: 10px; position: relative;
        }

        .santa-hat {
            position: absolute; top: -12px; left: 10px; width: 30px;
            transform: rotate(-15deg); pointer-events: none;
        }

        .beta-tag {
            font-size: 0.65rem; background: rgba(128, 128, 128, 0.1);
            color: #94a3b8; padding: 2px 6px; border-radius: 4px;
            font-weight: 600; margin-top: 4px; display: inline-block;
        }

        .search-box {
            padding: 12px; background: var(--input-bg); border: 1px solid var(--border);
            border-radius: 10px; color: var(--text); margin-bottom: 20px;
            width: 100%; box-sizing: border-box; outline: none; font-size: 0.85rem;
        }

        .nav-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; }
        .nav-item {
            padding: 10px 14px; border-radius: 10px; cursor: pointer;
            margin-bottom: 6px; transition: all 0.2s ease;
            font-size: 0.85rem; color: #94a3b8; display: flex; align-items: center; gap: 10px;
        }
        .nav-item:hover { background: rgba(0, 255, 136, 0.05); color: var(--text); }
        .nav-item.active { background: var(--primary); color: #000; font-weight: 700; }

        .top-actions { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 1001; }
        .action-btn {
            background: var(--card); border: 1px solid var(--border); color: var(--text);
            padding: 8px 12px; border-radius: 10px; cursor: pointer;
            font-size: 0.8rem; font-weight: 600; display: flex; align-items: center; gap: 6px;
        }

        .mobile-header {
            display: none; width: 100%; background: var(--card); padding: 10px 15px;
            border-bottom: 1px solid var(--border); position: fixed; top: 0; left: 0;
            z-index: 1000; box-sizing: border-box; flex-direction: column; gap: 5px;
        }
        .mobile-top-bar { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .mobile-tool-select {
            background: var(--input-bg); color: var(--primary); border: 1px solid var(--primary);
            padding: 10px; border-radius: 10px; font-size: 0.95rem; outline: none; width: 100%; font-weight: 600;
        }

        .main-content {
            flex-grow: 1; display: flex; flex-direction: column; align-items: center;
            justify-content: flex-start; padding: 60px 20px 40px; overflow-y: auto; position: relative;
        }

        .lang-bar { display: flex; gap: 5px; }
        .sidebar .lang-bar { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border); }
        .lang-btn {
            background: var(--card); border: 1px solid var(--border); color: var(--text);
            padding: 6px 10px; border-radius: 8px; cursor: pointer; font-size: 0.75rem; font-weight: 600; flex: 1;
        }
        .lang-btn.active { border-color: var(--primary); color: var(--primary); background: rgba(0, 255, 136, 0.1); }

        .tool-card {
            background: var(--card); padding: 30px; border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1); width: 100%; max-width: 600px;
            border: 1px solid var(--border); margin-bottom: 40px; min-height: 420px;
            display: flex; flex-direction: column; position: relative; z-index: 10;
        }

        h2 { margin: 0 0 10px 0; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .tool-desc { color: #64748b; font-size: 0.85rem; margin-bottom: 25px; line-height: 1.4; }

        .input-row { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .input-group { flex: 1; min-width: 140px; }

        label {
            display: block; margin-bottom: 12px; font-size: 0.85rem;
            color: #94a3b8; text-transform: uppercase; font-weight: 800; letter-spacing: 0.5px;
        }

        input, select {
            width: 100%; padding: 14px; background: var(--input-bg);
            border: 1px solid var(--border); border-radius: 12px; color: var(--text);
            font-size: 1rem; box-sizing: border-box;
        }

        .calc-btn {
            width: 100%; padding: 16px; background: var(--primary); color: #000;
            border: none; border-radius: 12px; font-weight: 800; cursor: pointer;
            text-transform: uppercase; font-size: 0.9rem; margin-top: auto; flex-shrink: 0;
        }

        .btn-group { display: flex; gap: 10px; margin-top: auto; }
        .nav-btn {
            flex: 1; padding: 16px; background: var(--primary); color: #000;
            border: none; border-radius: 12px; font-weight: 800; cursor: pointer; text-transform: uppercase;
        }
        .nav-btn.secondary { background: rgba(128, 128, 128, 0.1); color: var(--text); border: 1px solid var(--border); }

        .ai-btn {
            background: var(--accent); color: white; padding: 18px; border-radius: 14px;
            font-weight: 800; border: none; cursor: pointer; display: flex;
            align-items: center; justify-content: center; gap: 12px; margin-top: 20px;
            width: 100%; font-size: 1.1rem; box-shadow: 0 6px 20px rgba(59, 130, 246, 0.2);
        }

        .result-container { margin-top: 30px; display: none; width: 100%; }
        .res-block {
            background: rgba(128, 128, 128, 0.05); border-radius: 16px;
            padding: 18px; margin-bottom: 12px; border: 1px solid var(--border);
        }

        .res-title, .ai-title { color: var(--primary); font-size: 0.65rem; font-weight: 900; text-transform: uppercase; margin-bottom: 5px; display: block; }
        .res-value { font-size: 1rem; font-weight: 500; line-height: 1.5; }
        .highlight { color: var(--primary); font-weight: 800; }

        .progress-container { width: 100%; height: 6px; background: var(--border); border-radius: 10px; margin-bottom: 30px; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--primary); transition: width 0.4s ease; }

        #snow-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; display: none; }

        @media (max-width: 850px) {
            .sidebar { display: none; }
            .mobile-header { display: flex; }
            .main-content { padding-top: 140px; padding-left: 15px; padding-right: 15px; height: auto; }
            .tool-card { padding: 20px; min-height: 450px; }
            .top-actions { top: 110px; right: 15px; scale: 0.9; }
        }
    </style>
</head>
<body class="dark-theme">

    <canvas id="snow-canvas"></canvas>

    <header class="mobile-header">
        <div class="mobile-top-bar">
            <div class="logo-container">
                <div class="logo">
                    <svg class="santa-hat" viewBox="0 0 100 100"><path d="M20,50 Q50,0 80,50 L85,60 Q50,45 15,60 Z" fill="#ff4444" stroke="#fff" stroke-width="2"/><circle cx="85" cy="60" r="8" fill="#fff" /><path d="M15,60 Q50,50 85,60 L85,70 Q50,60 15,70 Z" fill="#fff" /></svg>
                    SHOCKING MATH ‚ö°
                </div>
                <div class="beta-tag">BETA v1.0</div>
            </div>
            <div class="lang-bar">
                <button class="lang-btn active" id="m-lang-en" onclick="changeLang('en')">EN</button>
                <button class="lang-btn" id="m-lang-sr" onclick="changeLang('sr')">SR</button>
            </div>
        </div>
        <select class="mobile-tool-select" id="mobile-nav" onchange="selectMobileTool(this.value)"></select>
    </header>

    <aside class="sidebar">
        <div class="logo-container">
            <div class="logo">
                <svg class="santa-hat" viewBox="0 0 100 100"><path d="M20,50 Q50,0 80,50 L85,60 Q50,45 15,60 Z" fill="#ff4444" stroke="#fff" stroke-width="2"/><circle cx="85" cy="60" r="8" fill="#fff" /><path d="M15,60 Q50,50 85,60 L85,70 Q50,60 15,70 Z" fill="#fff" /></svg>
                SHOCKING MATH ‚ö°
            </div>
            <div class="beta-tag">BETA v1.0</div>
        </div>
        <input type="text" class="search-box" id="search" placeholder="Pretra≈æi..." onkeyup="filterTools()">
        <ul class="nav-list" id="nav-list"></ul>
        <div class="lang-bar">
            <button class="lang-btn active" id="d-lang-en" onclick="changeLang('en')">EN</button>
            <button class="lang-btn" id="d-lang-sr" onclick="changeLang('sr')">SR</button>
        </div>
    </aside>

    <main class="main-content">
        <div class="top-actions">
            <button class="action-btn" onclick="toggleSnow()" id="snow-toggle-btn"><span>üå´Ô∏è</span> <span class="btn-text">Snow Off</span></button>
            <button class="action-btn" onclick="toggleTheme()" id="theme-toggle-btn"><span>üåô</span> <span class="btn-text">Dark</span></button>
        </div>
        <div id="tool-view" style="width: 100%; display: flex; justify-content: center;"></div>
    </main>

<script>
    let activeLang = 'en';
    let activeTool = "lifestyle";
    let quizStep = 0;
    let quizData = {};
    let isDarkMode = true;
    let isSnowing = false;

    const toolDefinitions = [
        { id: "lifestyle", emoji: "üß™", inputs: ["age", "smoke", "packs", "smoke_start", "drink", "alcohol_freq", "drink_start", "diet", "consume_pork"] },
        { id: "human", emoji: "üë§", inputs: ["age"] },
        { id: "oxygen", emoji: "üå¨Ô∏è", inputs: ["age"] },
        { id: "scroll", emoji: "üì±", inputs: ["age", "start", "hours"] },
        { id: "coffee", emoji: "‚òï", inputs: ["age", "start", "daily"] },
        { id: "perfume", emoji: "üß¥", inputs: ["size", "price", "sprays", "freq"] },
        { id: "exam", emoji: "üìö", inputs: ["pages", "pph", "hours"] },
        { id: "toilet", emoji: "üöΩ", inputs: ["age", "min", "daily"] },
        { id: "sleep", emoji: "üò¥", inputs: ["shours"] },
        { id: "books", emoji: "üìñ", inputs: ["age", "pday"] },
        { id: "bezos", emoji: "üí∞", inputs: ["salary"] },
        { id: "pizza", emoji: "üçï", inputs: ["monthly"] },
        { id: "commute", emoji: "üöó", inputs: ["chours", "cyears"] },
        { id: "words", emoji: "üó£Ô∏è", inputs: ["age"] },
        { id: "sitting", emoji: "ü™ë", inputs: ["shours_day", "syears"] },
        { id: "waiting", emoji: "‚è≥", inputs: ["age"] }
    ];

    const translations = {
        en: {
            nav: ["Lifestyle Quiz", "Human Body Stats", "Oxygen Factory", "Scroll Everest", "Coffee Ocean", "Perfume Value", "Exam Timer", "Toilet Warp", "Sleep Debt", "Book Worm", "Bezos vs You", "Pizza Surface", "Commute Life", "Words Library", "Sitting Life", "Waiting Line"],
            h: ["Lifestyle Shock Quiz", "Human Body Facts", "Oxygen Factory", "Scroll Distance", "Coffee Ocean", "Perfume Value", "Exam Prep", "Toilet Time", "Sleep Debt", "Book Worm", "The Bezos Gap", "Pizza Surface", "Traffic Trap", "Talking Library", "The Chair Trap", "Queue Specialist"],
            d: ["Discover the total volume of your habits.", "Biological impact of your existence.", "Amount of oxygen you've consumed and CO2 produced.", "Vertical distance you've scrolled.", "The literal ocean of caffeine consumed.", "True cost of smelling good.", "Study sessions based on volume.", "Life spent on the porcelain throne.", "Cost of staying awake vs rest.", "Volume of books you have consumed.", "Billionaire vs your annual wage.", "Total surface of dough eaten.", "Time lost in traffic jams.", "Library of words you've spoken.", "Impact of a sedentary lifestyle.", "Time spent waiting in queues."],
            lbl: {
                age: "Your age", smoke: "Do you smoke?", packs: "Packs/Day", smoke_start: "Smoking since", drink: "Do you drink?", alcohol_freq: "Drinks/Week", drink_start: "Drinking since", diet: "Diet", consume_pork: "Consume pork?",
                start: "Started at", hours: "Hours/Day", daily: "Times/Day", size: "Size (ml)", price: "Price (‚Ç¨)", sprays: "Sprays", freq: "Days/Week", pages: "Pages", pph: "Pages/h", min: "Min/Session", shours: "Sleep Hours", pday: "Pages/Day", monthly: "Pizzas/Month", salary: "Salary (‚Ç¨)", chours: "Hours/Day", cyears: "Years", shours_day: "Hours Sitting", syears: "Years",
                btn: "Calculate üöÄ", ai_btn: "Get ‚ú® AI Insight", ai_loading: "Analyzing...", ai_title: "AI Analysis ‚ú®", soon: "Feature coming soon! üöÄ", opt_yes: "Yes", opt_no: "No", opt_normal: "Normal", opt_vegan: "Vegan", opt_veg: "Vegetarian", next: "Next", back: "Back", themeDark: "Dark", themeLight: "Light", snowOn: "Snow On", snowOff: "Snow Off"
            },
            res_t: ["The Shock üò±", "The Math üìä"],
            facts: ["Heartbeat", "Breaths", "Hair growth", "Feces", "Urine", "Dead skin"],
            units: ["beats", "times", "km", "kg", "L", "kg"],
            ofacts: ["Oxygen Consumed", "CO2 Produced", "Trees Required"],
            ounits: ["liters", "kg", "trees"],
            life_res: ["Smoking Impact", "Alcohol Impact", "Diet Impact"]
        },
        sr: {
            nav: ["≈Ωivotni kviz", "Ljudsko telo", "Fabrika kiseonika", "Scroll Everest", "Okean kafe", "Cena parfema", "Ispit tajmer", "WC vreme", "Dug spavanja", "ƒåitaƒç knjiga", "Bezos i ti", "Povr≈°ina pice", "≈Ωivot u putu", "Biblioteka reƒçi", "≈Ωivot u stolici", "Red ƒçekanja"],
            h: ["≈†ok kviz navika", "ƒåinjenice o telu", "Fabrika kiseonika", "Scroll kilometra≈æa", "Okean kafe", "Vrednost parfema", "Spremanje ispita", "WC vremenska ma≈°ina", "Dug spavanja", "ƒåitaƒç knjiga", "Bezosov ponor", "Povr≈°ina pice", "Zemlja u gu≈ævi", "Govorna biblioteka", "Zamka stolice", "Specijalista za redove"],
            d: ["Otkrij pravu zapreminu tvojih navika.", "Izraƒçunaj svoj biolo≈°ki uticaj do sada.", "Koliƒçina kiseonika koju si potro≈°io i CO2 koji si proizveo.", "Koliko si visoko skrolovao vertikalno.", "Doslovni okean kofeina koji si popio.", "Prava cena tvog dobrog mirisa.", "Isplaniraj uƒçenje na osnovu strana.", "Vreme provedeno na porcelanskom tronu.", "Cena nespavanja u odnosu na odmor.", "Zapremina znanja u knjigama.", "Koliko brzo Bezos zaradi tvoju platu.", "Ukupna povr≈°ina testa koju si pojeo.", "Vreme izgubljeno u saobraƒáaju.", "Biblioteka reƒçi koje si izgovorio.", "Fiziƒçki uticaj sedenja.", "Vreme provedeno u redovima."],
            lbl: {
                age: "Godine", smoke: "Pu≈°aƒç?", packs: "Pakli/Dan", smoke_start: "Pu≈°i≈° od", drink: "Pije≈°?", alcohol_freq: "Piƒáa/Nedeljno", drink_start: "Pije≈° od", diet: "Ishrana", consume_pork: "Svinjetina?",
                start: "Poƒçeo sa", hours: "Sati dnevno", daily: "Dnevno puta", size: "Veliƒçina (ml)", price: "Cena (‚Ç¨)", sprays: "Prskanja", freq: "Dana/Nedeljno", pages: "Strana", pph: "Strana/h", min: "Min/Sesiji", shours: "Sati sna", pday: "Strana/Dan", monthly: "Pica/Mesec", salary: "Plata (‚Ç¨)", chours: "Sati/Dan", cyears: "Godina", shours_day: "Sati sedenja", syears: "Godina",
                btn: "Izraƒçunaj üöÄ", ai_btn: "Zatra≈æi ‚ú® AI Uvid", ai_loading: "Analiziram...", ai_title: "AI Analiza ‚ú®", soon: "Funkcija sti≈æe uskoro! üöÄ", opt_yes: "Da", opt_no: "Ne", opt_normal: "Normalna", opt_vegan: "Vegan", opt_veg: "Vegetarijanac", next: "Dalje", back: "Nazad", themeDark: "Tamna", themeLight: "Svetla", snowOn: "Sneg On", snowOff: "Sneg Off"
            },
            res_t: ["≈†ok podatak üò±", "Matematika üìä"],
            facts: ["Otkucaji srca", "Udisaji", "Rast kose", "Izmet", "Urin", "Mrtva ko≈æa"],
            units: ["otkucaja", "puta", "km", "kg", "L", "kg"],
            ofacts: ["Potro≈°en kiseonik", "Proizveden CO2", "Potrebno drveƒáa"],
            ounits: ["litara", "kg", "stabala"],
            life_res: ["Uticaj pu≈°enja", "Uticaj alkohola", "Uticaj ishrane"]
        }
    };

    function formatNumber(n) { return new Intl.NumberFormat('de-DE').format(Math.floor(n)); }

    function changeLang(l) {
        activeLang = l;
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`d-lang-${l}`).classList.add('active');
        document.getElementById(`m-lang-${l}`).classList.add('active');
        updateActionButtons(); refreshSidebar(); renderActiveTool();
    }

    function toggleTheme() {
        isDarkMode = !isDarkMode;
        document.body.classList.toggle('light-theme', !isDarkMode);
        updateActionButtons();
    }

    function updateActionButtons() {
        const d = translations[activeLang] || translations['en'];
        const tb = document.getElementById('theme-toggle-btn');
        const sb = document.getElementById('snow-toggle-btn');
        tb.querySelector('.btn-text').innerText = isDarkMode ? d.lbl.themeDark : d.lbl.themeLight;
        tb.querySelector('span:first-child').innerText = isDarkMode ? 'üåô' : '‚òÄÔ∏è';
        sb.querySelector('.btn-text').innerText = isSnowing ? d.lbl.snowOn : d.lbl.snowOff;
        sb.querySelector('span:first-child').innerText = isSnowing ? '‚ùÑÔ∏è' : 'üå´Ô∏è';
    }

    function selectMobileTool(v) { activeTool = v; quizStep = 0; quizData = {}; refreshSidebar(); renderActiveTool(); }

    function refreshSidebar(f = "") {
        const d = translations[activeLang] || translations['en'];
        const list = document.getElementById('nav-list');
        const mNav = document.getElementById('mobile-nav');
        list.innerHTML = ""; mNav.innerHTML = "";
        toolDefinitions.forEach((t, i) => {
            const name = d.nav[i];
            if (name.toLowerCase().includes(f.toLowerCase())) {
                const li = document.createElement('li');
                li.className = `nav-item ${t.id === activeTool ? 'active' : ''}`;
                li.innerHTML = `<span>${t.emoji}</span> ${name}`;
                li.onclick = () => { activeTool = t.id; quizStep = 0; quizData = {}; refreshSidebar(f); renderActiveTool(); };
                list.appendChild(li);
            }
            const opt = document.createElement('option');
            opt.value = t.id; opt.innerText = `${t.emoji} ${name}`; opt.selected = t.id === activeTool; mNav.appendChild(opt);
        });
    }

    function renderActiveTool() {
        if (activeTool === 'lifestyle') { renderLifestyleQuiz(); return; }
        const tIdx = toolDefinitions.findIndex(t => t.id === activeTool);
        const t = toolDefinitions[tIdx];
        const d = translations[activeLang] || translations['en'];
        const view = document.getElementById('tool-view');
        let inputsHtml = "";
        for (let i = 0; i < t.inputs.length; i++) {
            const key = t.inputs[i];
            if (i % 2 === 0) inputsHtml += '<div class="input-row">';
            inputsHtml += `<div class="input-group"><label>${d.lbl[key]}</label><input type="text" id="in-${key}" value="${formatNumber(getDefaultValue(key))}" oninput="handleInput(event)"></div>`;
            if (i % 2 === 1 || i === t.inputs.length - 1) inputsHtml += '</div>';
        }
        view.innerHTML = `<div class="tool-card active"><h2>${t.emoji} ${d.h[tIdx]}</h2><p class="tool-desc">${d.d[tIdx]}</p>${inputsHtml}<button class="calc-btn" onclick="runCalculation()">${d.lbl.btn}</button><div class="result-container" id="res-box"></div></div>`;
    }

    function renderLifestyleQuiz() {
        const d = translations[activeLang] || translations['en'];
        const view = document.getElementById('tool-view');
        const steps = toolDefinitions[0].inputs;
        const key = steps[quizStep];
        const prog = ((quizStep + 1) / steps.length) * 100;
        let inputEl = "";
        if (["smoke", "drink", "consume_pork"].includes(key)) {
            inputEl = `<select id="in-quiz-${key}"><option value="yes" ${quizData[key] === 'yes' ? 'selected' : ''}>${d.lbl.opt_yes}</option><option value="no" ${quizData[key] === 'no' ? 'selected' : ''}>${d.lbl.opt_no}</option></select>`;
        } else if (key === 'diet') {
            inputEl = `<select id="in-quiz-${key}"><option value="normal" ${quizData[key] === 'normal' ? 'selected' : ''}>${d.lbl.opt_normal}</option><option value="vegan" ${quizData[key] === 'vegan' ? 'selected' : ''}>${d.lbl.opt_vegan}</option><option value="veg" ${quizData[key] === 'veg' ? 'selected' : ''}>${d.lbl.opt_veg}</option></select>`;
        } else {
            inputEl = `<input type="number" id="in-quiz-${key}" value="${quizData[key] || getDefaultValue(key)}">`;
        }
        view.innerHTML = `<div class="tool-card active"><div class="progress-container"><div class="progress-bar" style="width: ${prog}%"></div></div><h2>üß™ ${d.h[0]}</h2><p class="tool-desc">${d.d[0]}</p><div style="margin-bottom: 30px;"><label>${d.lbl[key]}</label>${inputEl}</div><div class="btn-group">${quizStep > 0 ? `<button class="nav-btn secondary" onclick="prevQuizStep()">${d.lbl.back}</button>` : ''}<button class="nav-btn" onclick="nextQuizStep()">${quizStep === steps.length - 1 ? d.lbl.btn : d.lbl.next}</button></div><div class="result-container" id="res-box"></div></div>`;
    }

    function nextQuizStep() {
        const steps = toolDefinitions[0].inputs;
        const key = steps[quizStep];
        const val = document.getElementById(`in-quiz-${key}`).value;
        quizData[key] = val;
        if (key === 'smoke' && val === 'no') { quizStep = 4; } 
        else if (key === 'drink' && val === 'no') { quizStep = 7; } 
        else { quizStep++; }
        if (quizStep >= steps.length) { quizStep = steps.length - 1; runCalculation(); } 
        else { renderActiveTool(); }
    }

    function prevQuizStep() {
        if (quizStep === 7 && quizData['drink'] === 'no') { quizStep = 4; } 
        else if (quizStep === 4 && quizData['smoke'] === 'no') { quizStep = 1; } 
        else { quizStep--; }
        if (quizStep < 0) quizStep = 0;
        renderActiveTool();
    }

    function handleInput(e) {
        let v = e.target.value.replace(/\D/g, "");
        if (v === "") { e.target.value = ""; return; }
        e.target.value = new Intl.NumberFormat('de-DE').format(parseInt(v));
    }

    function getDefaultValue(k) {
        const d = { age: 25, packs: 1, smoke_start: 18, alcohol_freq: 5, drink_start: 18, start: 14, hours: 4, daily: 2, size: 100, price: 150, sprays: 5, freq: 7, pages: 300, pph: 6, min: 20, shours: 6, pday: 25, monthly: 4, salary: 45000, chours: 1, cyears: 15, shours_day: 8, syears: 10 };
        return d[k] || 0;
    }

    function runCalculation() {
        const d = translations[activeLang] || translations['en'];
        const vals = {};

        if (activeTool === 'lifestyle') {
            const age = parseFloat(quizData.age) || 1;
            const res = [];
            if (quizData.smoke === 'yes') {
                const sY = Math.max(0, age - parseFloat(quizData.smoke_start));
                const p = parseFloat(quizData.packs);
                const tC = Math.round(sY * 365.25 * p * 20);
                const tM = Math.round(sY * 365.25 * p * 5.45);
                res.push({ icon: "üö¨", label: d.life_res[0], value: activeLang === 'sr' ? `Popu≈°eno <span class="highlight">${formatNumber(tC)}</span> cigareta. Potro≈°eno <span class="highlight">${formatNumber(tM)} ‚Ç¨</span>. To je <span class="highlight">${formatNumber(tC/20)}</span> pakli.` : `Smoked <span class="highlight">${formatNumber(tC)}</span> cigarettes. Spent <span class="highlight">${formatNumber(tM)} ‚Ç¨</span>. That's <span class="highlight">${formatNumber(tC/20)}</span> packs.` });
            }
            if (quizData.drink === 'yes') {
                const dY = Math.max(0, age - parseFloat(quizData.drink_start));
                const tD = Math.round(dY * 52.17 * parseFloat(quizData.alcohol_freq));
                const tL = Math.round(tD * 0.45 * 10) / 10; 
                res.push({ icon: "üç∫", label: d.life_res[1], value: activeLang === 'sr' ? `Konzumirano <span class="highlight">${formatNumber(tL)} litara</span> alkohola kroz <span class="highlight">${formatNumber(tD)}</span> piƒáa.` : `Consumed <span class="highlight">${formatNumber(tL)} liters</span> of alcohol across <span class="highlight">${formatNumber(tD)}</span> drinks.` });
            }
            const totalMeat = Math.round(age * 365.25 * 0.228);
            let dietD = (quizData.diet === 'vegan') ? (activeLang === 'sr' ? `Spasio si <span class="highlight">${formatNumber(age * 365)}</span> ≈æivotinja.` : `Saved <span class="highlight">${formatNumber(age * 365)}</span> animals.`) : 
                       (quizData.diet === 'veg') ? (activeLang === 'sr' ? `Po≈°tedeo si <span class="highlight">${formatNumber(age * 182)}</span> ≈æivotinja.` : `Spared <span class="highlight">${formatNumber(age * 182)}</span> animals.`) :
                       (activeLang === 'sr' ? `Pojeo si <span class="highlight">${formatNumber(totalMeat)} kg</span> mesa.` : `Ate <span class="highlight">${formatNumber(totalMeat)} kg</span> of meat.`);
            if (quizData.consume_pork === 'no') dietD += activeLang === 'sr' ? ` Izbegao si <span class="highlight">~${formatNumber(age * 44.5)} kg</span> svinjetine.` : ` Avoided <span class="highlight">~${formatNumber(age * 44.5)} kg</span> of pork.`;
            res.push({ icon: "üçΩÔ∏è", label: d.life_res[2], value: dietD });
            renderHumanResults(res);
            return;
        }

        const t = toolDefinitions.find(t => t.id === activeTool);
        t.inputs.forEach(id => { 
            const el = document.getElementById(`in-${id}`);
            if(el) vals[id] = parseFloat(el.value.replace(/\./g, "")) || 0; 
        });

        if (activeTool === 'human') {
            const a = vals.age || 1;
            renderHumanResults([
                { icon: "‚ù§Ô∏è", label: d.facts[0], value: formatNumber(a * 365.25 * 24 * 60 * 72), unit: d.units[0] },
                { icon: "üå¨Ô∏è", label: d.facts[1], value: formatNumber(a * 365.25 * 24 * 60 * 14), unit: d.units[1] },
                { icon: "üíá", label: d.facts[2], value: (a * 365.25 * 0.35 * 100000 / 1000000).toFixed(1), unit: d.units[2] },
                { icon: "üí©", label: d.facts[3], value: formatNumber(a * 365.25 * 0.128), unit: d.units[3] },
                { icon: "üß™", label: d.facts[4], value: formatNumber(a * 365.25 * 1.5), unit: d.units[4] },
                { icon: "üêç", label: d.facts[5], value: (a * 0.85).toFixed(1), unit: d.units[5] }
            ]);
        } else if (activeTool === 'oxygen') {
            const a = vals.age || 1; const co2 = a * 365.25 * 1.05;
            renderHumanResults([{ icon: "ü´Å", label: d.ofacts[0], value: formatNumber(a * 365.25 * 550), unit: d.ounits[0] }, { icon: "üè≠", label: d.ofacts[1], value: formatNumber(co2), unit: d.ounits[1] }, { icon: "üå≥", label: d.ofacts[2], value: formatNumber(Math.ceil(co2 / 21)), unit: d.ounits[2] }]);
        } else {
            const y = Math.max(0, vals.age - (vals.start || 0));
            const totalP = vals.pday * 365.25 * (vals.age || 1);
            const msgs = {
                en: {
                    scroll: [`You scrolled <span class="highlight">${formatNumber(vals.hours * 0.18 * 365.25 * y)} km</span>. That's <span class="highlight">${((vals.hours * 0.18 * 365.25 * y) / 8.848).toFixed(1)} Everests</span>!`, `0.18km/h speed across ${y} years.`],
                    coffee: [`You drank <span class="highlight">${formatNumber(Math.floor(vals.daily * 0.18 * 365.25 * y))} liters</span>. That's <span class="highlight">${(Math.floor(vals.daily * 0.18 * 365.25 * y) / 150).toFixed(1)} bathtubs</span>!`, `180ml cup across ${y} years.`],
                    perfume: [`1 spray costs <span class="highlight">${(vals.price / (vals.size * 10 || 1)).toFixed(2)} ‚Ç¨</span>. Bottle lasts <span class="highlight">${formatNumber(Math.floor((vals.size * 10) / (vals.sprays * (vals.freq/7) || 1)))} days</span>.`, `Based on 10 sprays per 1ml.`],
                    bezos: [`Bezos earns your salary in <span class="highlight">${(vals.salary / 2200).toFixed(2)} seconds</span>.`, `Estimated ~2.200 ‚Ç¨ earning per second.`],
                    pizza: [`You eat <span class="highlight">${(vals.monthly * 12 * 0.07).toFixed(2)} m¬≤</span> of pizza per year.`, `Average pizza is 0.07m¬≤.`],
                    books: [`You read <span class="highlight">${formatNumber(totalP)}</span> pages. That's approx. <span class="highlight">${formatNumber(totalP / 300)}</span> books.`, `Based on ~300 pages per book.`],
                    sleep: [`You lose <span class="highlight">${((8 - vals.shours) * 365.25 / 24).toFixed(1)} days</span> of recovery per year.`, `Against 8h optimal sleep daily.`],
                    exam: [`You need <span class="highlight">${((vals.pages / (vals.pph || 1)) / (vals.hours || 1)).toFixed(1)} days</span>. Total: <span class="highlight">${(vals.pages / (vals.pph || 1)).toFixed(1)} hours</span>.`, `${formatNumber(vals.pages)} pages at ${vals.pph} str/h.`],
                    toilet: [`In life (80y), you'll spend <span class="highlight">${formatNumber(Math.floor((vals.min * vals.daily * 365.25 * 80) / 1440))} days</span> on the throne.`, `Based on your habits.`],
                    words: [`Spoken equivalent to <span class="highlight">${formatNumber(Math.floor((vals.age * 365.25 * 7000) / 50000))}</span> thick books.`, `Avg 7.000 words per day.`],
                    sitting: [`Spent <span class="highlight">${(vals.shours_day * 365.25 * vals.syears / 8760).toFixed(1)} years</span> sitting.`, `Converted to full years.`],
                    waiting: [`Spent <span class="highlight">${formatNumber(Math.floor(vals.age * 3.5))} days</span> in lines.`, `Est. 3.5 days/year waiting.`],
                    commute: [`Spent <span class="highlight">${formatNumber(Math.floor((vals.chours * 250 * vals.cyears) / 24))} days</span> in traffic.`, `Based on 250 work days/year.`]
                },
                sr: {
                    scroll: [`Skrolovao si <span class="highlight">${formatNumber(vals.hours * 0.18 * 365.25 * y)} km</span>. To je visina <span class="highlight">${((vals.hours * 0.18 * 365.25 * y) / 8.848).toFixed(1)} Mont Everesta</span>!`, `Brzina 0.18km/h tokom ${y} godina.`],
                    coffee: [`Popio si <span class="highlight">${formatNumber(Math.floor(vals.daily * 0.18 * 365.25 * y))} litara</span>. To puni <span class="highlight">${(Math.floor(vals.daily * 0.18 * 365.25 * y) / 150).toFixed(1)} kadi</span>!`, `180ml po ≈°olji tokom ${y} god.`],
                    perfume: [`Jedno prskanje ko≈°ta <span class="highlight">${(vals.price / (vals.size * 10 || 1)).toFixed(2)} ‚Ç¨</span>. Boƒçica traje <span class="highlight">${formatNumber(Math.floor((vals.size * 10) / (vals.sprays * (vals.freq/7) || 1)))} dana</span>.`, `Na bazi 10 prskanja po 1ml.`],
                    bezos: [`Bezos zaradi tvoju platu za <span class="highlight">${(vals.salary / 2200).toFixed(2)} sekundi</span>.`, `Procenjeno ~2.200 ‚Ç¨ u sekundi.`],
                    pizza: [`Godi≈°nje pojede≈° <span class="highlight">${(vals.monthly * 12 * 0.07).toFixed(2)} m¬≤</span> pice.`, `Proseƒçna pica je 0.07m¬≤.`],
                    books: [`Proƒçitao si <span class="highlight">${formatNumber(totalP)}</span> stranica. To je oko <span class="highlight">${formatNumber(totalP / 300)}</span> knjiga.`, `Na bazi ~300 strana po knjizi.`],
                    sleep: [`Gubi≈° <span class="highlight">${((8 - vals.shours) * 365.25 / 24).toFixed(1)} dana</span> odmora godi≈°nje.`, `U odnosu na idealnih 8h sna.`],
                    exam: [`Treba ti <span class="highlight">${((vals.pages / (vals.pph || 1)) / (vals.hours || 1)).toFixed(1)} dana</span>. Ukupno: <span class="highlight">${(vals.pages / (vals.pph || 1)).toFixed(1)} sati</span>.`, `${formatNumber(vals.pages)} strana pri ${vals.pph} str/h.`],
                    toilet: [`Za ≈æivot (80g) prove≈°ƒáe≈° <span class="highlight">${formatNumber(Math.floor((vals.min * vals.daily * 365.25 * 80) / 1440))} dana</span> na ≈°olji.`, `Bazirano na tvojim navikama.`],
                    words: [`Izgovorio si reƒçi za <span class="highlight">${formatNumber(Math.floor((vals.age * 365.25 * 7000) / 50000))}</span> knjiga.`, `Prosek od 7.000 reƒçi dnevno.`],
                    sitting: [`Proveo si <span class="highlight">${(vals.shours_day * 365.25 * vals.syears / 8760).toFixed(1)} godina</span> sedeƒái.`, `Pretvoreno u pune godine.`],
                    waiting: [`ƒåekao si u redovima ukupno <span class="highlight">${formatNumber(Math.floor(vals.age * 3.5))} dana</span>.`, `Procena 3.5 dana godi≈°nje.`],
                    commute: [`Proveo si <span class="highlight">${formatNumber(Math.floor((vals.chours * 250 * vals.cyears) / 24))} dana</span> u putu.`, `Na bazi 250 radnih dana godi≈°nje.`]
                }
            };
            const cM = msgs[activeLang] || msgs['en'];
            renderResultsArea(activeTool, activeTool, cM[activeTool] || ["Processed.", "Check stats."]);
        }
    }

    function renderHumanResults(d) {
        const c = document.getElementById(`res-box`); c.innerHTML = "";
        d.forEach(i => { const dv = document.createElement('div'); dv.className = "res-block"; dv.style.display = "flex"; dv.style.alignItems = "center"; dv.style.gap = "15px"; dv.innerHTML = `<span style="font-size: 1.5rem;">${i.icon}</span><div><span class="res-title">${i.label}</span><div class="res-value">${i.value} ${i.unit || ''}</div></div>`; c.appendChild(dv); });
        addAIBtn(c); c.style.display = "block";
    }

    function renderResultsArea(id, t, dS) {
        const c = document.getElementById(`res-box`); const d = translations[activeLang] || translations['en']; c.innerHTML = "";
        dS.forEach((tx, i) => { const dv = document.createElement('div'); dv.className = "res-block"; dv.innerHTML = `<span class="res-title">${d.res_t[i] || "Result"}</span><div class="res-value">${tx}</div>`; c.appendChild(dv); });
        addAIBtn(c); c.style.display = "block";
    }

    function addAIBtn(c) {
        const d = translations[activeLang] || translations['en']; const b = document.createElement('button'); b.className = "ai-btn"; b.innerHTML = `<span class="btn-label">${d.lbl.ai_btn}</span>`;
        b.onclick = () => { let bx = document.getElementById('ai-box'); if (!bx) { bx = document.createElement('div'); bx.id = `ai-box`; bx.className = "ai-block"; c.appendChild(bx); } bx.style.display = "block"; bx.innerHTML = `<span class="ai-title">${d.lbl.ai_title}</span><div class="res-value" id="ai-val">${d.lbl.soon}</div>`; };
        c.appendChild(b);
    }

    const canvas = document.getElementById('snow-canvas'); const ctx = canvas.getContext('2d'); let snowflakes = [];
    function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    function createSnowflakes() { snowflakes = []; for (let i = 0; i < 150; i++) { snowflakes.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, radius: Math.random() * 4 + 1, speed: Math.random() * 1 + 0.5, wind: Math.random() * 0.5 - 0.25 }); } }
    function updateSnow() { if (!isSnowing) return; ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.fillStyle = isDarkMode ? "white" : "#cbd5e1"; ctx.beginPath(); snowflakes.forEach(f => { ctx.moveTo(f.x, f.y); ctx.arc(f.x, f.y, f.radius, 0, Math.PI * 2); f.y += f.speed; f.x += f.wind; if (f.y > canvas.height) f.y = -10; if (f.x > canvas.width) f.x = 0; if (f.x < 0) f.x = canvas.width; }); ctx.fill(); requestAnimationFrame(updateSnow); }
    function toggleSnow() { isSnowing = !isSnowing; canvas.style.display = isSnowing ? 'block' : 'none'; if (isSnowing) { resizeCanvas(); createSnowflakes(); updateSnow(); } updateActionButtons(); }
    window.addEventListener('resize', resizeCanvas);
    refreshSidebar(); renderActiveTool(); updateActionButtons();
</script>
</body>
</html>
